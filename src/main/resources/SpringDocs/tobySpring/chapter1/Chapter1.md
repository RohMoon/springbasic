# 1장
## 오브젝트와 의존관계
- 스프링은 자바를 기반으로 한 기술이므로 가장 주용하게 가치를 두는 것은 객체지향 프로그래밍이 가능한 언어라는 점이다.
- 스프링을 이해라면 오브젝트에 깊은 관심이 필요.
    - 어플리케이션에서 오브젝트가 생성되고 다른 오브젝트와 관계를 맺고, 사용되고, 소멸하기까지의 전 과정을 생각해야한다.
    - 오브젝트는 어덯게 설계돼야 하는지, 어떤 단위로 만들어지며 어떤 과정을 통해 자신의 존재를 드러내고 등장해야 하는지에 대해서도 살펴봐야 한다.
    
- 결국 오브젝트에 대한 관심은 오브젝트의 기술적인 특징과 사용 방법을 넘어서 오브젝트의 설계로 발전하게 된다.
  - 객체지향 설계(object oriented design)의 기초와 원칙을 비롯해서 다양한 목적을 위해 재활용 가능한 설계 방법인 디자인 패턴,  
    좀 더 깔끔한 구조가 되도록 지속적으로 개선해나가는 작업인 리팩토링,  
    오브젝트가 기대한 대로 동작하고 있는지를 효과적으로 검증하는 데 쓰이는 단위 테스트와 같은 오브젝트 설계와 구현에 관한 여러 가지 으용 기술과 지식이 요구된다.
    
- 스프링은 객체지향 설계와 구현에 관해 특정한 모델과 기법을 억지로 가용하지 않는다.  
하지만 오브젝트를 어떻게 효과적으로 설계하고 구현하고, 사용하고, 이를 개선해나갈 것인가에 대한 명쾌한 기준을 마련해준다.
  - 동시에 스프링은 객체지향 기술과 설계, 구현에 관한 실용적인 전략과 검증된 베스트 프랙티스를 평범한 개발자도 자연스럽고 손쉽게 적용할 수 있도록 프레임워크 형태로 제공한다.
   

### 초난감 DAO
- 사용자 정보를 JDBC API를 통해 DB에 저장하고 조회할 수 잇는 간단한 DAO를 하나 만들어보자.

> DAO
> dAO( Data Access Object )는 DB를 사용해 데이터를 조회하거나 조작하는 기능을 전담하도록 만든 오브젝트를 말한다.

### User
- 사용자정보를 저장할 때는 자바빈 규약을 따르는 오브젝트를 이용하면 편리하다.  
사용자 정보를 저장할 User 클래스를 만든다. 리스트 1-1 은 id, name, password 세 개의 프로퍼티를 가진 User 클래스다.
- 이제 User 오브젝트에 담긴 정보가 실제로 보관될 DB의 테이블을 하나 만들어보자 
```java
package com.tobySpring.chapter1;

public class User {
    String id;
    String name;
    String password;

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}
```
> 자바빈
> 자바빈(JAVABEAN)은 원래 비주얼 툴에서 조작 가능한 컴포넌트를 말한다.
> 자바의 주력 개발 프랠폿임 웹 기반의 엔터프라이즈 방식으로 바뀌면서 컴포넌트로서 자바빈은 인기를 잃어갔지만,
> 자바빈의 몇 가지 코딩 관례는 JSP 빈, EJB와 같은 표준 기술과 자바빈 스타일의 오브젝트를 사용하는 오픈소스 기술을 통해 계속 이어져 왔다.
> 이제는 자바빈이라고 말하면 비주얼 컴포넌트라고보다는 다음 두 가지 관례를 따라 만들어진 오브젝트를 가리킨다. 간단히 빈이라고 부르기도 한다.
>   - 디폴트 생성자 : 자바빈은 파라미터가 없는 디폴트 생성자를 갖고 있어야 한다. 툴이나 프레임 워크에서 리플렉션을 이욯애 오브젝트를 생성하기 때문에 필요하다.
>   - 프로퍼티 : 자바빈이 노출하는 이름을 가진 속성을 프로퍼티라고 한다.프로퍼티는 set으로 시작하는 수정자 메서드(setter) get으로 시작하는 접근자 메서드(getter)를 이용해 수정 또는 조회할 수 있다.

### UserDao
- 사용자 정보를 DB에 넣고 관리할 수 있는 dAO 클래스를 만들어보자.
  - JDBC를 이용하는 작업의 일반적인 순서는 다음과 같다.
    - DB 연결을 위한 Connection을 가져온다.
    - SQL을 담은 Statement (또는 PreparedStatement)를 만든다.
    - 만들어진 Statement를 실행한다.
    - 조회의 경우 SQL 쿼리의 실행 결과를 ResultSet으로 받아서 정보를 저장할 오브젝트(여기서는 User)에 옮겨준다.
    - 작업 중에 생성된 Connection, Statement, ResultSet같은 리소스는 작업을 마친 후 반드시 닫아준다.
    - JDBC API가 만들어내는 예외를 잡아서 직접 처리하거나, 메서드에 throws를 선언해서 예외가 발생하면 메서드 밖으로 던지게 한다.
  - 일단 예외는 모두 메서드 밖으로 던져버리는 편이 간단하다.  
  리스트 1-2는 JDBC API의 기본적인 사용 방법을 따라서 만든 UserDAO 클래스다.

### main()을 이용한 DAO 테스트 코드
- 모든 클래스에는 자신을 엔트리 포인트로 설정해 직접 실행이 가능하게 해주는 스태틱 메서드 main()이 있다.
  - 먼저 User 오브젝트를 생성하고 프로퍼티에 값을 넣은 다음에 add() 메서드를 이용해 DB에 등록해본다.
  - Connection설정과 코등 모두 이상이 없다면 main 매서드가 에러없이 종료될것이라는 시나리오이다.


## DAO의 분리
### 관심사의 분리
- 객체지향의 세계에서는 모든 것이 변한다. 여기서 변한다는 것은 변수나 오브젝트 필드의 값이 변한다는게 아니다.  
오브젝트에 대한 설계와 이를 구현한 코드가 변한다는 뜻이다.  
소프트웨어 개발에서 끝이란 개념이 없다.

- 개발자가 객체를 설계할 때 가장 염두에 둬야할 사항은 바로 미래의 변화를 어떻게 대비할 것인가 이다.
- 객체지향 설계와 프로그래밍이 이전의 절차적 프로그래밍 패러다임에 비해 초기에 좀 더 많은, 번거로운 작업을 요구하는 이유는 객체지향 기술자체가 지니는,  
변화에 효과적으로 대처할 수 있다는 기술적인 특징 때문이다.  
- 객체 지향 기술은 흔히 실세계를 최대한 가깝게 모델링 해낼 수 있기 때문에 의미가 있다고 여겨지기도 하지만,  
그보다는 객체지향 기술이 만들어내는 가상의 추상세계 자체를 효과적으로 구성할 수 있고, 이를 자유롭고 편리하게 변경, 발전, 확장시킬 수 있다는 데 더 의미가 있다.
- **분리와 확장** 을 고려한 설계가 중요하다.

#### 분리
- 모든 변경과 발전은 한 번에 한 가지 관심사항에 집중해서 일어난다.
- 변화는 대체로 집중된 한 가지 관심에 대해 일어나지만 그에 따른 작업은 한 곳에 집중되지 않는 경우가 많다.
- 변화가 한 번에 한 가지 관심에 집중돼어 일어나기 때문에, 우리가 준비해야 할 일은 한가지 관심이 한 군데에 집중되게 하는 것이다.
  - 즉 관심이 같은 것끼리는 모으고 관심이 다른 것은 따로 떨어져 있게 하는 것이다.
- 프로그램 기초 개념 중에 **관심사의 분리(Separation of Concerns)** 라는 개념이 있다.
  - 객체지향에 적용해보면, 관심이 같은 것끼리는 하나의 객체 안으로 또는 친한 객체로 모이게 하고, 관심이 다르 것은 가능한 한 따로 떨어져서 서로 영향을 주지 않도록 분리하는 것이라고 생각할 수 있다.

### 커넥션 만들기의 추출
#### UserDao의 관심사항
1. DB와 연결을 위한 커넥션을 어떻게 가져올까라는 관심
  - 어떤 DB를 쓰고, 어떤 드라이버를 쓰고, 어떤 로그인 정보를 쓰는데, 그 커넥션을 생성하는 방법은 또 어떤 것이다라는 것까지 구분해서 볼 수도 있다.

2. 사용자 등록을 위해 DB에 보낼 SQL 문장을 담을 Statement를 만들고 실행하는 것.
  - 파라미터로 넘어온 사용자 정보를 Statement를 바인딩.
  - Statement에 담긴 SQL을 DB를 통해 실행시키는 방법.
  - 파라미터를 바인딩하는 것과 어떤 SQL을 사용할지를 다른 관심사로 분리할 수도 있다.
3. 작업이 끝나면 사용한 리소스인 Statement 와 Connection 오브젝트르 닫아서 자원 반납한다.

- 현재 UserDao에는 예외상황에 대한 처리가 전혀 없다.
1. DB연결을 위한 Connectio 오브젝트를 가져오는 부분이다.
  - 현재 DB 커넥션을 가져오는 코드는 다른 관심사와 섞여서 같은 add()메서등 담겨 있다. 
  - 더 큰 문제는 add() 메서드에 있는 DB 커넥션을 가져오는 코드와 동일한 코드가 get()메서드에 증복된다.

### 중복 코드의 메서드 추출
- 공통의 기능을 담당하는 메소드로 중복된 코드를 뽑아내는 것을 메서드 추출 (extract method)라고 한다.

### DB 커넥션 만들기의 독립

### 상속을 통한 확장
- 추상 클래스/ 추상 메서드를 통해 확장 가능
- 상속을 통해 DB 커넥션 연결이라는 관심을 이번에는 상속을 통해 서브클래스로 분리가능.
- 수정한 코드에서 DAO의 핵심 기능인 어떻게 데이터를 등록하고 가져올 것인가(SQL 작성, 파라미터 바인딩, 쿼리 실행, 검색정보 전달)라는 관심을 담당하는 `UserDao`와 DB연결 방법은 어떻게 할 것인가라는 관심을 담고 있는 NUser,DUserDao가 클래스 레벨로 구분이 되고 있다.
- 클래스 계층 구조를 통해 두 개의 관심이 독립적으로 분리되면서 변경 작업이 용이해짐.

#### 템플릿 메서드 패턴 (Template method Pattern)
  - 슈퍼클래스에 기본적인 로직의 흐름(커넥션 가져오기, SQL 생성, 실행, 반환)을 만들고, 그 기능의 일부를 추상 메서드나 오버라이딩이 가능한 protected 메서드 등으로 만든 뒤 서브 클래스에서 이런 메서드를 필요에 맞게 구현해서 사용하도록 하는 방법.

#### 팩토리 메서드 패턴 (Factory Method Pattern)
- 서브 클래스에서 구체적인 오브젝트 생성 방법을 결정하게 하는 것.
  - 예: UserDao의 getConncetion() 메서드는 Connection 타입 오브젝트를 생성한다는 기능을 정의해놓은 추상 메서드다. 
  - 그리고 UserDao의 서브클래스의 getConnection()은 어떤 Connection 클래스의 오브젝트를 생성할 것인지를 결정하는 방법.